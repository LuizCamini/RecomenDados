CREATE
OR ALTER VIEW VW_CLIENTESLGPD AS
SELECT c.clienteid AS id
     , CASE WHEN LEN(C.CPFCNPJ) = 14 THEN REPLACE(SUBSTRING(C.CPFCNPJ,1,3) ,SUBSTRING(C.CPFCNPJ,1,3) ,'***') +'.'+ SUBSTRING(C.CPFCNPJ,5,3) +'.'+ SUBSTRING(C.CPFCNPJ,9,3) +'-'+REPLACE(SUBSTRING(C.CPFCNPJ,13,2) ,SUBSTRING(C.CPFCNPJ,13,2) ,'**')
            WHEN LEN(C.CPFCNPJ) = 18 THEN REPLACE(SUBSTRING(C.CPFCNPJ,1,2) ,SUBSTRING(C.CPFCNPJ,1,2) ,'**') +'.'+SUBSTRING(C.CPFCNPJ,4,3) +'.'+SUBSTRING(C.CPFCNPJ,8,3) +SUBSTRING(C.CPFCNPJ,11,5) +'-'+REPLACE(SUBSTRING(C.CPFCNPJ,17,2) ,SUBSTRING(C.CPFCNPJ,17,2) ,'**')
       END AS CPFCNPJ
     , TRANSLATE(C.RAZAOSOCIAL,'AEI','***') AS RAZAOSOCIAL
     , TRANSLATE(C.NOMEFANTASIA,'AEI','***') AS NOMEFANTASIA
     , REPLACE(C.CEP,'0','*') CEP
     , TRANSLATE(C.ENDERECO,'AEI','***') AS ENDERECO
     , C.NUMERO
     , TRANSLATE(C.BAIRRO,'AEI','***') AS BAIRRO
     , TRANSLATE(C.CIDADE,'AEI','***') AS CIDADE
     , C.UF
     , C.COMPLEMENTO
     , REPLACE(SUBSTRING(C.TELEFONE,2,2) ,SUBSTRING(C.TELEFONE,2,2) ,'**') +REPLACE(SUBSTRING(C.TELEFONE,5,4) ,SUBSTRING(C.TELEFONE,5,4) ,'**') +SUBSTRING(C.TELEFONE,10,4) AS TELEFONE
     , REPLACE(SUBSTRING(C.CELULAR,2,2) ,SUBSTRING(C.CELULAR,2,2) ,'**') +REPLACE(SUBSTRING(C.CELULAR,5,4) ,SUBSTRING(C.CELULAR,5,4) ,'**') +SUBSTRING(C.CELULAR,10,4) AS CELULAR
     , C.INSCRICAOESTADUAL
     , CASE WHEN C.TIPOCLIENTE = 'J' THEN 'CLIENTE JURIDICO'
            WHEN C.TIPOCLIENTE = 'F' THEN 'CLIENTE FISICO'
                                     ELSE 'INTERNACIONAL'
       END AS TIPOCLIENTE
     , RMATV.RamoAtividadeDesc
     , C.INSCRICAOESTADUALSUBSTITUICAOTRIBUTARIAUF
     , C.INSCRICAOESTADUALSUBSTITUICAOTRIBUTARIA
     , C.TIPOENVIOEMAILLOTEDACTEXML
     , FORMAT(C.DATACADASTRO,'dd/MM/yyyy','pt-br') as DATACADASTRO
     , FORMAT(C.DATAALTERACAO,'dd/MM/yyyy','pt-br') as DATAALTERACAO
     , C.USUARIOIDCADASTRO
     , C.USUARIOIDALTERACAO
     , C.ATIVO
     , CASE WHEN C.DIFICILENTREGA = 0 THEN 'N√ÉO POSSUI DIFICULDADE DE ENTREGA'
            WHEN C.DIFICILENTREGA = 1 THEN 'POSSUI DIFICULDADE DE ENTREGA'
       END AS DIFICILENTREGA
     , V.CPFCNPJ AS VENDEDORCPFCNPJ
     , V.NOME AS VENDEDORNOME
     , C.VENDEDORID AS VENDEDORID
  FROM CLIENTES C LEFT JOIN
       VENDEDORES V ON V.VENDEDORID = C.VENDEDORID INNER JOIN
       SitraWebnew.DBO.RamoAtividade AS RMATV ON C.RamoAtividadeId = RMATV.RamoAtividadeId;

